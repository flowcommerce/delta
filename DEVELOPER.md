building docker images
======================
go run ~/go/src/github.com/flowcommerce/tools/dev.go tag --label micro
go run ~/go/src/github.com/flowcommerce/tools/dev.go build_docker_image

api
===
project defining the REST API itself. See spec/delta.json for a full
description of the API.

www
===
project defining the web application

Generated Code
==============
The .apibuilder file lists the specific targets which are generated by
apibuilder. To regenerate code, clone github.com/gilt/apibuilder-cli and

    apibuilder upload flow delta ./spec/delta.json --version `sem-info tag next`
    apibuilder upload flow delta-config ./spec/delta-config.json --version `sem-info tag next`

    apibuilder update

Database
========

    See https://github.com/flowcommerce/delta-postgresql

Running locally
===============

In one screen:

    $ sbt
    sbt> project api
    sbt> run 6091

In another screen:

    $ sbt
    sbt> project www
    sbt> run 6090

Goto http://localhost:6090 in your browser

Running with docker-compose
===========================

Download development.txt from S3 and place it in the root delta folder. Then modify to add:

CONF_DB_DEFAULT_URL=jdbc:postgresql://db:5432/deltadb
CONF_DELTA_API_HOST=http://api:9000
CONF_DELTA_WWW_HOST=http://localhost:6090

$ docker-compose build
$ docker-compose up

Goto http://localhost:6090 in your browser

Environment Variables
=====================

- Docker Hub
    - CONF_DOCKERHUB_DELTA_AUTH_EMAIL
        - Email for docker hub login
    - CONF_DOCKERHUB_DELTA_AUTH_TOKEN
        - Docker hub auth token provided in ~/.docker configuration
    - CONF_DOCKER_JWT_TOKEN
        - JWT Token provided by Docker Hub
    - CONF_DOCKER_USERNAME
        - Username for dockerhub login
    - CONF_DOCKER_PASSWORD
        - Password for dockerhub login
- Travis CI
    - CONF_TRAVIS_DELTA_AUTH_TOKEN_PRIVATE
        - Travis CI auth token for private repos (.com)
    - CONF_TRAVIS_DELTA_AUTH_TOKEN_PUBLIC
        - Travis CI auth token for public repos (.org)
- GitHub
    - CONF_GITHUB_DELTA_LOCALHOST_CLIENT_ID
    - CONF_GITHUB_DELTA_CLIENT_SECRET
    - CONF_GITHUB_DELTA_CLIENT_ID
    - CONF_GITHUB_DELTA_LOCALHOST_CLIENT_SECRET
    - CONF_GITHUB_CLIENT_ID
- AWS
    - CONF_AWS_ELB_SUBNETS
        - Comma-separated list of subnet IDs to be used by ELB
    - CONF_AWS_LAUNCH_CONFIGURATION_ROLE
        - Launch configuration IAM role
    - CONF_AWS_ASG_HEALTHCHECK_GRACE_PERIOD
        - Number of seconds for autoscaling health checks
    - CONF_AWS_SERVICE_KEY
        - Keypair used by launch configuration
    - CONF_AWS_SERVICE_ROLE
        - AWS ECS service role
    - CONF_AWS_ASG_MAX_SIZE
        - Maximum size of auto-scaling group
    - CONF_AWS_ELB_CERTIFICATE
        - SSL ARN certificate to be used if HTTPS listeners are desired
    - CONF_AWS_ELB_HEALTHCHECK_URL
        - Healthcheck URL for ELB
    - CONF_AWS_DELTA_ACCESS_KEY
        - AWS IAM Access Key
    - CONF_AWS_DELTA_SECRET_KEY
        - AWS IAM Secret Key
    - CONF_AWS_LAUNCH_CONFIGURATION_AMI
        - AWS Marketplace AMI to be used to launch new EC2 instances
        - We recommend using ami-1d48ab70
    - CONF_AWS_LAUNCH_CONFIGURATION_SECURITY_GROUP
        - Security group used by launch configuration to create new EC2 instances
    - CONF_AWS_ASG_MIN_SIZE
    - CONF_AWS_ASG_DESIRED_SIZE
    - CONF_AWS_AUTOSCALING_SUBNETS
        - Comma-separated list of subnet IDs to be used by Auto-scaling group
    - CONF_AWS_SERVICE_SECURITY_GROUP: sg-55bb682d
    - CONF_AWS_OPSWORKS_LAYER_ID
        - Opsworks Layer ID
    - CONF_AWS_OPSWORKS_SNS_TOPIC_ARN
        - Opsworks SNS topic ARN
    - CONF_AWS_OPSWORKS_STACK_ID
        - Opsworks Stack ID

- RDS/Postgresql
    - CONF_DB_DEFAULT_PASS
        - Database password
    - CONF_DB_DEFAULT_URL
        - Database JDBC connection string
- Miscellaneous
    - CONF_DELTA_API_HOST
        - Host for the Delta API service
    - CONF_DELTA_WWW_HOST
        - Host for Delta Web Front-end
